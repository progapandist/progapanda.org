{"id":"App.svelte","dependencies":[{"name":"/Users/andybarnov/code/progapandist/rnd/webterm/package.json","includedInParent":true,"mtime":1587321851150},{"name":"svelte/internal","loc":{"line":17,"column":7},"parent":"/Users/andybarnov/code/progapandist/rnd/webterm/src/App.svelte","resolved":"/Users/andybarnov/code/progapandist/rnd/webterm/node_modules/svelte/internal/index.mjs"},{"name":"xterm","loc":{"line":20,"column":25},"parent":"/Users/andybarnov/code/progapandist/rnd/webterm/src/App.svelte","resolved":"/Users/andybarnov/code/progapandist/rnd/webterm/node_modules/xterm/lib/xterm.js"},{"name":"svelte","loc":{"line":21,"column":24},"parent":"/Users/andybarnov/code/progapandist/rnd/webterm/src/App.svelte","resolved":"/Users/andybarnov/code/progapandist/rnd/webterm/node_modules/svelte/index.mjs"},{"name":"xterm/css/xterm.css","loc":{"line":22,"column":7},"parent":"/Users/andybarnov/code/progapandist/rnd/webterm/src/App.svelte","resolved":"/Users/andybarnov/code/progapandist/rnd/webterm/node_modules/xterm/css/xterm.css"},{"name":"_css_loader","parent":"/Users/andybarnov/code/progapandist/rnd/webterm/src/App.svelte","resolved":"/Users/andybarnov/code/progapandist/rnd/webterm/node_modules/parcel-bundler/src/builtins/css-loader.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _internal = require(\"svelte/internal\");\n\nvar _xterm = require(\"xterm\");\n\nvar _svelte = require(\"svelte\");\n\nrequire(\"xterm/css/xterm.css\");\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar console_1 = _internal.globals.console,\n    document_1 = _internal.globals.document;\nvar file = \"App.svelte\";\n\nfunction add_css() {\n  var style = (0, _internal.element)(\"style\");\n  style.id = \"svelte-12p2fj1-style\";\n  style.textContent = \"main.svelte-12p2fj1{background-color:black;margin:0}#xterm.svelte-12p2fj1{width:100%;height:100vh}\\n\";\n  (0, _internal.append_dev)(document_1.head, style);\n}\n\nfunction create_fragment(ctx) {\n  var main;\n  var div;\n  var block = {\n    c: function create() {\n      main = (0, _internal.element)(\"main\");\n      div = (0, _internal.element)(\"div\");\n      (0, _internal.attr_dev)(div, \"id\", \"xterm\");\n      (0, _internal.attr_dev)(div, \"class\", \"svelte-12p2fj1\");\n      (0, _internal.add_location)(div, file, 179, 2, 4734);\n      (0, _internal.attr_dev)(main, \"class\", \"svelte-12p2fj1\");\n      (0, _internal.add_location)(main, file, 178, 0, 4725);\n    },\n    l: function claim(nodes) {\n      throw new Error(\"options.hydrate only works if the component was compiled with the `hydratable: true` option\");\n    },\n    m: function mount(target, anchor) {\n      (0, _internal.insert_dev)(target, main, anchor);\n      (0, _internal.append_dev)(main, div);\n      /*div_binding*/\n\n      ctx[3](div);\n    },\n    p: _internal.noop,\n    i: _internal.noop,\n    o: _internal.noop,\n    d: function destroy(detaching) {\n      if (detaching) (0, _internal.detach_dev)(main);\n      /*div_binding*/\n\n      ctx[3](null);\n    }\n  };\n  (0, _internal.dispatch_dev)(\"SvelteRegisterBlock\", {\n    block: block,\n    id: create_fragment.name,\n    type: \"component\",\n    source: \"\",\n    ctx: ctx\n  });\n  return block;\n}\n\nfunction instance($$self, $$props, $$invalidate) {\n  var UTF8Decoder = function UTF8Decoder() {\n    // The number of bytes left in the current sequence.\n    this.bytesLeft = 0; // The in-progress code point being decoded, if bytesLeft > 0.\n\n    this.codePoint = 0; // The lower bound on the final code point, if bytesLeft > 0.\n\n    this.lowerBound = 0;\n  };\n  /**\n  * Decodes a some UTF-8 data, taking into account state from previous\n  * data streamed through the encoder.\n  *\n  * @param {String} str data to decode, represented as a JavaScript\n  *     String with each code unit representing a byte between 0x00 to\n  *     0xFF.\n  * @return {String} The data decoded into a JavaScript UTF-16 string.\n  */\n\n\n  UTF8Decoder.prototype.decode = function (str) {\n    var ret = \"\";\n\n    for (var i = 0; i < str.length; i++) {\n      var c = str.charCodeAt(i);\n\n      if (this.bytesLeft == 0) {\n        if (c <= 127) {\n          ret += str.charAt(i);\n        } else if (192 <= c && c <= 223) {\n          this.codePoint = c - 192;\n          this.bytesLeft = 1;\n          this.lowerBound = 128;\n        } else if (224 <= c && c <= 239) {\n          this.codePoint = c - 224;\n          this.bytesLeft = 2;\n          this.lowerBound = 2048;\n        } else if (240 <= c && c <= 247) {\n          this.codePoint = c - 240;\n          this.bytesLeft = 3;\n          this.lowerBound = 65536;\n        } else if (248 <= c && c <= 251) {\n          this.codePoint = c - 248;\n          this.bytesLeft = 4;\n          this.lowerBound = 2097152;\n        } else if (252 <= c && c <= 253) {\n          this.codePoint = c - 252;\n          this.bytesLeft = 5;\n          this.lowerBound = 67108864;\n        } else {\n          ret += \"�\";\n        }\n      } else {\n        if (128 <= c && c <= 191) {\n          this.bytesLeft--;\n          this.codePoint = (this.codePoint << 6) + (c - 128);\n\n          if (this.bytesLeft == 0) {\n            // Got a full sequence. Check if it's within bounds and\n            // filter out surrogate pairs.\n            var codePoint = this.codePoint;\n\n            if (codePoint < this.lowerBound || 55296 <= codePoint && codePoint <= 57343 || codePoint > 1114111) {\n              ret += \"�\";\n            } else {\n              // Encode as UTF-16 in the output.\n              if (codePoint < 65536) {\n                ret += String.fromCharCode(codePoint);\n              } else {\n                // Surrogate pair.\n                codePoint -= 65536;\n                ret += String.fromCharCode(55296 + (codePoint >>> 10 & 1023), 56320 + (codePoint & 1023));\n              }\n            }\n          }\n        } else {\n          // Too few bytes in multi-byte sequence. Rewind stream so we\n          // don't lose the next byte.\n          ret += \"�\";\n          this.bytesLeft = 0;\n          i--;\n        }\n      }\n    }\n\n    return ret;\n  };\n\n  var decodeUTF8 = function decodeUTF8(utf8) {\n    return new UTF8Decoder().decode(utf8);\n  };\n\n  var terminalDiv;\n  (0, _svelte.onMount)(function () {\n    var term = null;\n    var websocket = new WebSocket(\"ws://localhost:4567/term\");\n    websocket.binaryType = \"arraybuffer\"; // ????\n\n    function ab2str(buf) {\n      return decodeUTF8(String.fromCharCode.apply(null, new Uint8Array(buf)));\n    }\n\n    websocket.onopen = function (evt) {\n      term = new _xterm.Terminal({\n        cursorBlink: true,\n        screenKeys: true,\n        useStyle: true\n      });\n\n      if (term) {\n        term.setOption(\"logLevel\", \"debug\");\n        console.log(term.cols, \"x\", term.rows);\n        term.onData(function (data) {\n          websocket.send(new TextEncoder().encode(\"\\0\" + data));\n        });\n        term.onResize(function (evt) {\n          websocket.send(new TextEncoder().encode(\"\\x01\" + JSON.stringify({\n            cols: evt.cols,\n            rows: evt.rows\n          })));\n        });\n        term.onTitleChange(function (title) {\n          document.title = title;\n        });\n        term.open(terminalDiv);\n        term.focus();\n      }\n    };\n\n    websocket.onmessage = function (evt) {\n      term.write(ab2str(evt.data));\n    };\n\n    websocket.onclose = function (evt) {\n      if (term) {\n        term.write(\"Session terminated\");\n      }\n    };\n\n    websocket.onerror = function (evt) {\n      if (typeof console.log == \"function\") {\n        console.log(evt);\n      }\n    };\n  });\n  var writable_props = [];\n  Object.keys($$props).forEach(function (key) {\n    if (!~writable_props.indexOf(key) && key.slice(0, 2) !== \"$$\") console_1.warn(\"<App> was created with unknown prop '\".concat(key, \"'\"));\n  });\n  var _$$props$$$slots = $$props.$$slots,\n      $$slots = _$$props$$$slots === void 0 ? {} : _$$props$$$slots,\n      $$scope = $$props.$$scope;\n  (0, _internal.validate_slots)(\"App\", $$slots, []);\n\n  function div_binding($$value) {\n    _internal.binding_callbacks[$$value ? \"unshift\" : \"push\"](function () {\n      $$invalidate(0, terminalDiv = $$value);\n    });\n  }\n\n  $$self.$capture_state = function () {\n    return {\n      Terminal: _xterm.Terminal,\n      onMount: _svelte.onMount,\n      UTF8Decoder: UTF8Decoder,\n      decodeUTF8: decodeUTF8,\n      terminalDiv: terminalDiv\n    };\n  };\n\n  $$self.$inject_state = function ($$props) {\n    if (\"UTF8Decoder\" in $$props) UTF8Decoder = $$props.UTF8Decoder;\n    if (\"decodeUTF8\" in $$props) decodeUTF8 = $$props.decodeUTF8;\n    if (\"terminalDiv\" in $$props) $$invalidate(0, terminalDiv = $$props.terminalDiv);\n  };\n\n  if ($$props && \"$$inject\" in $$props) {\n    $$self.$inject_state($$props.$$inject);\n  }\n\n  return [terminalDiv, UTF8Decoder, decodeUTF8, div_binding];\n}\n\nvar App = /*#__PURE__*/function (_SvelteComponentDev) {\n  _inherits(App, _SvelteComponentDev);\n\n  var _super = _createSuper(App);\n\n  function App(options) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _super.call(this, options);\n    if (!document_1.getElementById(\"svelte-12p2fj1-style\")) add_css();\n    (0, _internal.init)(_assertThisInitialized(_this), options, instance, create_fragment, _internal.safe_not_equal, {});\n    (0, _internal.dispatch_dev)(\"SvelteRegisterComponent\", {\n      component: _assertThisInitialized(_this),\n      tagName: \"App\",\n      options: options,\n      id: create_fragment.name\n    });\n    return _this;\n  }\n\n  return App;\n}(_internal.SvelteComponentDev);\n\nvar _default = App;\nexports.default = _default;","css":"main.svelte-12p2fj1{background-color:black;margin:0}#xterm.svelte-12p2fj1{width:100%;height:100vh}"},"sourceMaps":{"js":{"mappings":[],"sources":{},"lineCount":null}},"error":null,"hash":"7e3e6776b9b353498521cdc18eb6e375","cacheData":{"env":{}}}